define("echarts/chart/eventRiver",["require","./base","../layout/eventRiver","zrender/shape/Polygon","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","../util/date","zrender/tool/util","zrender/tool/color","../chart"],function(e){function t(e,t,r,a,l){i.call(this,e,t,r,a,l);var o=this;o._ondragend=function(){o.isDragend=!0},this.refresh(a)}var i=e("./base"),r=e("../layout/eventRiver"),a=e("zrender/shape/Polygon");e("../component/axis"),e("../component/grid"),e("../component/dataZoom");var l=e("../config");l.eventRiver={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"inside",formatter:"{b}"}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0}}}};var o=e("../util/ecData"),n=e("../util/date"),h=e("zrender/tool/util"),s=e("zrender/tool/color");return t.prototype={type:l.CHART_TYPE_EVENTRIVER,_buildShape:function(){var e=this.series;this.selectedMap={},this._dataPreprocessing();for(var t=this.component.legend,i=[],a=0;a<e.length;a++)if(e[a].type===this.type){e[a]=this.reformOption(e[a]),this.legendHoverLink=e[a].legendHoverLink||this.legendHoverLink;var l=e[a].name||"";if(this.selectedMap[l]=t?t.isSelected(l):!0,!this.selectedMap[l])continue;this.buildMark(a),i.push(this.series[a])}r(i,this._intervalX,this.component.grid.getArea()),this._drawEventRiver(),this.addShapeList()},_dataPreprocessing:function(){for(var e,t,i=this.series,r=0,a=i.length;a>r;r++)if(i[r].type===this.type){e=this.component.xAxis.getAxis(i[r].xAxisIndex||0);for(var l=0,o=i[r].data.length;o>l;l++){t=i[r].data[l].evolution;for(var h=0,s=t.length;s>h;h++)t[h].timeScale=e.getCoord(n.getNewDate(t[h].time)-0),t[h].valueScale=Math.pow(t[h].value,.8)}}this._intervalX=Math.round(this.component.grid.getWidth()/40)},_drawEventRiver:function(){for(var e=this.series,t=0;t<e.length;t++){var i=e[t].name||"";if(e[t].type===this.type&&this.selectedMap[i])for(var r=0;r<e[t].data.length;r++)this._drawEventBubble(e[t].data[r],t,r)}},_drawEventBubble:function(e,t,i){var r=this.series,l=r[t],n=l.name||"",h=l.data[i],d=[h,l],u=this.component.legend,v=u?u.getColor(n):this.zr.getColor(t),g=this.deepMerge(d,"itemStyle.normal")||{},f=this.deepMerge(d,"itemStyle.emphasis")||{},c=this.getItemStyleColor(g.color,t,i,h)||v,p=this.getItemStyleColor(f.color,t,i,h)||("string"==typeof c?s.lift(c,-.2):c),m=this._calculateControlPoints(e),y={zlevel:this.getZlevelBase(),z:this.getZBase(),clickable:this.deepQuery(d,"clickable"),style:{pointList:m,smooth:"spline",brushType:"both",lineJoin:"round",color:c,lineWidth:g.borderWidth,strokeColor:g.borderColor},highlightStyle:{color:p,lineWidth:f.borderWidth,strokeColor:f.borderColor},draggable:"vertical",ondragend:this._ondragend};y=new a(y),this.addLabel(y,l,h,e.name),o.pack(y,r[t],t,r[t].data[i],i,r[t].data[i].name),this.shapeList.push(y)},_calculateControlPoints:function(e){var t=this._intervalX,i=e.y,r=e.evolution,a=r.length;if(!(1>a)){for(var l=[],o=[],n=0;a>n;n++)l.push(r[n].timeScale),o.push(r[n].valueScale);var h=[];h.push([l[0],i]);var n=0;for(n=0;a-1>n;n++)h.push([(l[n]+l[n+1])/2,o[n]/-2+i]);for(h.push([(l[n]+(l[n]+t))/2,o[n]/-2+i]),h.push([l[n]+t,i]),h.push([(l[n]+(l[n]+t))/2,o[n]/2+i]),n=a-1;n>0;n--)h.push([(l[n]+l[n-1])/2,o[n-1]/2+i]);return h}},ondragend:function(e,t){this.isDragend&&e.target&&(t.dragOut=!0,t.dragIn=!0,t.needRefresh=!1,this.isDragend=!1)},refresh:function(e){e&&(this.option=e,this.series=e.series),this.backupShapeList(),this._buildShape()}},h.inherits(t,i),e("../chart").define("eventRiver",t),t}),define("echarts/layout/eventRiver",["require"],function(){function e(e,l,o){function n(e,t){var i=e.importance,r=t.importance;return i>r?-1:r>i?1:0}function h(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,r=e.length;r>i;i++)if(e[i]===t)return i;return-1}for(var s=5,d=l,u=0;u<e.length;u++){for(var v=0;v<e[u].data.length;v++){null==e[u].data[v].weight&&(e[u].data[v].weight=1);for(var g=0,f=0;f<e[u].data[v].evolution.length;f++)g+=e[u].data[v].evolution[f].valueScale;e[u].data[v].importance=g*e[u].data[v].weight}e[u].data.sort(n)}for(var u=0;u<e.length;u++){null==e[u].weight&&(e[u].weight=1);for(var g=0,v=0;v<e[u].data.length;v++)g+=e[u].data[v].weight;e[u].importance=g*e[u].weight}e.sort(n);for(var c=Number.MAX_VALUE,p=0,u=0;u<e.length;u++)for(var v=0;v<e[u].data.length;v++)for(var f=0;f<e[u].data[v].evolution.length;f++){var m=e[u].data[v].evolution[f].timeScale;c=Math.min(c,m),p=Math.max(p,m)}for(var y=i(Math.floor(c),Math.ceil(p)),b=0,u=0;u<e.length;u++)for(var v=0;v<e[u].data.length;v++){var C=e[u].data[v];C.time=[],C.value=[];for(var f=0;f<e[u].data[v].evolution.length;f++)C.time.push(e[u].data[v].evolution[f].timeScale),C.value.push(e[u].data[v].evolution[f].valueScale);var M=h(C.value,Math.max.apply(Math,C.value)),S=r(y,C.time[M],C.time[M+1]),f=0;for(C.y=S+C.value[M]/2+s,f=0;f<C.time.length-1;f++){var x=r(y,C.time[f],C.time[f+1]);C.y-C.value[f]/2-s<x&&(C.y=x+C.value[f]/2+s)}var x=r(y,C.time[f],C.time[f]+d);for(C.y-C.value[f]/2-s<x&&(C.y=x+C.value[f]/2+s),e[u].y=C.y,b=Math.max(b,C.y+C.value[M]/2),f=0;f<C.time.length-1;f++)a(y,C.time[f],C.time[f+1],C.y+C.value[f]/2);a(y,C.time[f],C.time[f]+d,C.y+C.value[f]/2)}t(e,o,b,s)}function t(e,t,i,r){for(var a=t.y,l=(t.height-r)/i,o=0;o<e.length;o++){e[o].y=e[o].y*l+a;for(var n=e[o].data,h=0;h<n.length;h++){n[h].y=n[h].y*l+a;for(var s=n[h].evolution,d=0;d<s.length;d++)s[d].valueScale*=1*l}}}function i(e,t){var r={left:e,right:t,leftChild:null,rightChild:null,maxValue:0};if(t>e+1){var a=Math.round((e+t)/2);r.leftChild=i(e,a),r.rightChild=i(a,t)}return r}function r(e,t,i){if(1>i-t)return 0;var a=Math.round((e.left+e.right)/2),l=0;if(t==e.left&&i==e.right)l=e.maxValue;else if(a>=i&&null!=e.leftChild)l=r(e.leftChild,t,i);else if(t>=a&&null!=e.rightChild)l=r(e.rightChild,t,i);else{var o=0,n=0;null!=e.leftChild&&(o=r(e.leftChild,t,a)),null!=e.rightChild&&(n=r(e.rightChild,a,i)),l=o>n?o:n}return l}function a(e,t,i,r){if(null!=e){var l=Math.round((e.left+e.right)/2);e.maxValue=e.maxValue>r?e.maxValue:r,(Math.floor(10*t)!=Math.floor(10*e.left)||Math.floor(10*i)!=Math.floor(10*e.right))&&(l>=i?a(e.leftChild,t,i,r):t>=l?a(e.rightChild,t,i,r):(a(e.leftChild,t,l,r),a(e.rightChild,l,i,r)))}}return e});