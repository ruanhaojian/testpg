define("echarts/chart/tree",["require","./base","zrender/tool/area","zrender/tool/vector","../util/shape/Icon","zrender/shape/Image","zrender/shape/Line","zrender/shape/BezierCurve","../layout/Tree","../data/Tree","../config","../util/ecData","zrender/config","zrender/tool/event","zrender/tool/util","../chart"],function(t){function e(t,e,o,r,a){i.call(this,t,e,o,r,a),this.refresh(r)}var i=t("./base"),o=.618,r=(t("zrender/tool/area"),t("zrender/tool/vector"),t("../util/shape/Icon")),a=t("zrender/shape/Image"),n=t("zrender/shape/Line"),h=t("zrender/shape/BezierCurve"),l=t("../layout/Tree"),s=t("../data/Tree"),d=t("../config");d.tree={zlevel:1,z:2,calculable:!1,clickable:!0,rootLocation:{},orient:"vertical",symbol:"circle",symbolSize:20,nodePadding:30,layerPadding:100,itemStyle:{normal:{label:{show:!0},lineStyle:{width:1,color:"#777",type:"curve"}},emphasis:{}}};var u=t("../util/ecData"),p=(t("zrender/config"),t("zrender/tool/event"),t("zrender/tool/util"));return e.prototype={type:d.CHART_TYPE_TREE,_buildShape:function(t,e){var i=t.data[0];this.tree=s.fromOptionData(i.name,i.children),this.tree.root.data=i,this._setTreeShape(t),this.tree.traverse(function(i){this._buildItem(i,t,e),i.children.length>0&&this._buildLink(i,t)},this);var o=t.roam===!0||"move"===t.roam,r=t.roam===!0||"scale"===t.roam;this.zr.modLayer(this.getZlevelBase(),{panable:o,zoomable:r}),(this.query("markPoint.effect.show")||this.query("markLine.effect.show"))&&this.zr.modLayer(d.EFFECT_ZLEVEL,{panable:o,zoomable:r}),this.addShapeList()},_buildItem:function(t,e,i){var o=[t.data,e],n=this.deepQuery(o,"symbol"),h=this.deepMerge(o,"itemStyle.normal")||{},l=this.deepMerge(o,"itemStyle.emphasis")||{},s=h.color||this.zr.getColor(),d=l.color||this.zr.getColor(),p=-t.layout.angle||0;t.id===this.tree.root.id&&(p=0);var y="right";Math.abs(p)>=Math.PI/2&&Math.abs(p)<3*Math.PI/2&&(p+=Math.PI,y="left");var c=[p,t.layout.position[0],t.layout.position[1]],g=new r({zlevel:this.getZlevelBase(),z:this.getZBase()+1,rotation:c,style:{x:t.layout.position[0]-.5*t.layout.width,y:t.layout.position[1]-.5*t.layout.height,width:t.layout.width,height:t.layout.height,iconType:n,color:s,brushType:"both",lineWidth:h.borderWidth,strokeColor:h.borderColor},highlightStyle:{color:d,lineWidth:l.borderWidth,strokeColor:l.borderColor}});g.style.iconType.match("image")&&(g.style.image=g.style.iconType.replace(new RegExp("^image:\\/\\/"),""),g=new a({rotation:c,style:g.style,highlightStyle:g.highlightStyle,clickable:g.clickable,zlevel:this.getZlevelBase(),z:this.getZBase()})),this.deepQuery(o,"itemStyle.normal.label.show")&&(g.style.text=null==t.data.label?t.id:t.data.label,g.style.textPosition=this.deepQuery(o,"itemStyle.normal.label.position"),"radial"===e.orient&&"inside"!==g.style.textPosition&&(g.style.textPosition=y),g.style.textColor=this.deepQuery(o,"itemStyle.normal.label.textStyle.color"),g.style.textFont=this.getFont(this.deepQuery(o,"itemStyle.normal.label.textStyle")||{})),this.deepQuery(o,"itemStyle.emphasis.label.show")&&(g.highlightStyle.textPosition=this.deepQuery(o,"itemStyle.emphasis.label.position"),g.highlightStyle.textColor=this.deepQuery(o,"itemStyle.emphasis.label.textStyle.color"),g.highlightStyle.textFont=this.getFont(this.deepQuery(o,"itemStyle.emphasis.label.textStyle")||{})),u.pack(g,e,i,t.data,0,t.id),this.shapeList.push(g)},_buildLink:function(t,e){var i=e.itemStyle.normal.lineStyle;if("broken"===i.type)return void this._buildBrokenLine(t,i,e);for(var o=0;o<t.children.length;o++){var r=t.layout.position[0],a=t.layout.position[1],n=t.children[o].layout.position[0],h=t.children[o].layout.position[1];switch(i.type){case"curve":this._buildBezierCurve(t,t.children[o],i,e);break;case"broken":break;default:var l=this._getLine(r,a,n,h,i);this.shapeList.push(l)}}},_buildBrokenLine:function(t,e,i){var r=p.clone(e);r.type="solid";var a=[],n=t.layout.position[0],h=t.layout.position[1],l=i.orient,s=t.children[0].layout.position[1],d=n,u=h+(s-h)*(1-o),y=t.children[0].layout.position[0],c=u,g=t.children[t.children.length-1].layout.position[0],f=u;if("horizontal"===l){var v=t.children[0].layout.position[0];d=n+(v-n)*(1-o),u=h,y=d,c=t.children[0].layout.position[1],g=d,f=t.children[t.children.length-1].layout.position[1]}a.push(this._getLine(n,h,d,u,r)),a.push(this._getLine(y,c,g,f,r));for(var m=0;m<t.children.length;m++)v=t.children[m].layout.position[0],s=t.children[m].layout.position[1],"horizontal"===l?c=s:y=v,a.push(this._getLine(y,c,v,s,r));this.shapeList=this.shapeList.concat(a)},_getLine:function(t,e,i,o,r){return t===i&&(t=i=this.subPixelOptimize(t,r.width)),e===o&&(e=o=this.subPixelOptimize(e,r.width)),new n({zlevel:this.getZlevelBase(),hoverable:!1,style:p.merge({xStart:t,yStart:e,xEnd:i,yEnd:o,lineType:r.type,strokeColor:r.color,lineWidth:r.width},r,!0)})},_buildBezierCurve:function(t,e,i,r){var a=o,n=r.orient,l=t.layout.position[0],s=t.layout.position[1],d=e.layout.position[0],u=e.layout.position[1],y=l,c=(u-s)*a+s,g=d,f=(u-s)*(1-a)+s;if("horizontal"===n)y=(d-l)*a+l,c=s,g=(d-l)*(1-a)+l,f=u;else if("radial"===n)if(t.id===this.tree.root.id)y=(d-l)*a+l,c=(u-s)*a+s,g=(d-l)*(1-a)+l,f=(u-s)*(1-a)+s;else{var v=t.layout.originPosition[0],m=t.layout.originPosition[1],b=e.layout.originPosition[0],z=e.layout.originPosition[1],S=this.tree.root.layout.position[0],_=this.tree.root.layout.position[1];y=v,c=(z-m)*a+m,g=b,f=(z-m)*(1-a)+m;var P=(y-this.minX)/this.width*Math.PI*2;y=c*Math.cos(P)+S,c=c*Math.sin(P)+_,P=(g-this.minX)/this.width*Math.PI*2,g=f*Math.cos(P)+S,f=f*Math.sin(P)+_}var w=new h({zlevel:this.getZlevelBase(),hoverable:!1,style:p.merge({xStart:l,yStart:s,cpX1:y,cpY1:c,cpX2:g,cpY2:f,xEnd:d,yEnd:u,strokeColor:i.color,lineWidth:i.width},i,!0)});this.shapeList.push(w)},_setTreeShape:function(t){var e=new l({nodePadding:t.nodePadding,layerPadding:t.layerPadding});this.tree.traverse(function(e){var i=[e.data,t],o=this.deepQuery(i,"symbolSize");"number"==typeof o&&(o=[o,o]),e.layout={width:o[0],height:o[1]}},this),e.run(this.tree);var i=t.orient,o=t.rootLocation.x,r=t.rootLocation.y,a=this.zr.getWidth(),n=this.zr.getHeight();o="center"===o?.5*a:this.parsePercent(o,a),r="center"===r?.5*n:this.parsePercent(r,n),r=this.parsePercent(r,n),"horizontal"===i&&(o=isNaN(o)?10:o,r=isNaN(r)?.5*n:r),"radial"===i?(o=isNaN(o)?.5*a:o,r=isNaN(r)?.5*n:r):(o=isNaN(o)?.5*a:o,r=isNaN(r)?10:r);var h=this.tree.root.layout.position[0];if("radial"===i){var s=1/0,d=0,u=0;this.tree.traverse(function(t){d=Math.max(d,t.layout.position[0]),s=Math.min(s,t.layout.position[0]),u=Math.max(u,t.layout.width)}),this.width=d-s+2*u,this.minX=s}this.tree.traverse(function(t){var e=t.layout.position[0]-h+o,a=t.layout.position[1]+r;if("horizontal"===i&&(a=t.layout.position[0]-h+r,e=t.layout.position[1]+o),"radial"===i){e=t.layout.position[0],a=t.layout.position[1],t.layout.originPosition=[e,a];var n=a,l=(e-s)/this.width*Math.PI*2;e=n*Math.cos(l)+o,a=n*Math.sin(l)+r,t.layout.angle=l}t.layout.position[0]=e,t.layout.position[1]=a},this)},refresh:function(t){this.clear(),t&&(this.option=t,this.series=this.option.series);for(var e=this.series,i=this.component.legend,o=0;o<e.length;o++)if(e[o].type===d.CHART_TYPE_TREE){e[o]=this.reformOption(e[o]);var r=e[o].name||"";if(this.selectedMap[r]=i?i.isSelected(r):!0,!this.selectedMap[r])continue;this._buildSeries(e[o],o)}},_buildSeries:function(t,e){this._buildShape(t,e)}},p.inherits(e,i),t("../chart").define("tree",e),e}),define("echarts/layout/Tree",["require","zrender/tool/vector"],function(t){function e(t){t=t||{},this.nodePadding=t.nodePadding||30,this.layerPadding=t.layerPadding||100,this._layerOffsets=[],this._layers=[]}var i=t("zrender/tool/vector");return e.prototype.run=function(t){this._layerOffsets.length=0;for(var e=0;e<t.root.height+1;e++)this._layerOffsets[e]=0,this._layers[e]=[];this._updateNodeXPosition(t.root);var i=t.root;this._updateNodeYPosition(i,0,i.layout.height)},e.prototype._updateNodeXPosition=function(t){var e=1/0,o=-(1/0);t.layout.position=t.layout.position||i.create();for(var r=0;r<t.children.length;r++){var a=t.children[r];this._updateNodeXPosition(a);var n=a.layout.position[0];e>n&&(e=n),n>o&&(o=n)}t.layout.position[0]=t.children.length>0?(e+o)/2:0;var h=this._layerOffsets[t.depth]||0;if(h>t.layout.position[0]){var l=h-t.layout.position[0];this._shiftSubtree(t,l);for(var r=t.depth+1;r<t.height+t.depth;r++)this._layerOffsets[r]+=l}this._layerOffsets[t.depth]=t.layout.position[0]+t.layout.width+this.nodePadding,this._layers[t.depth].push(t)},e.prototype._shiftSubtree=function(t,e){t.layout.position[0]+=e;for(var i=0;i<t.children.length;i++)this._shiftSubtree(t.children[i],e)},e.prototype._updateNodeYPosition=function(t,e,i){t.layout.position[1]=e;for(var o=0,r=0;r<t.children.length;r++)o=Math.max(t.children[r].layout.height,o);var a=this.layerPadding;"function"==typeof a&&(a=a(t.depth));for(var r=0;r<t.children.length;r++)this._updateNodeYPosition(t.children[r],e+a+i,o)},e}),define("echarts/data/Tree",["require","zrender/tool/util"],function(t){function e(t,e){this.id=t,this.depth=0,this.height=0,this.children=[],this.parent=null,this.data=e||null}function i(t){this.root=new e(t)}var o=t("zrender/tool/util");return e.prototype.add=function(t){var e=this.children;t.parent!==this&&(e.push(t),t.parent=this)},e.prototype.remove=function(t){var e=this.children,i=o.indexOf(e,t);i>=0&&(e.splice(i,1),t.parent=null)},e.prototype.traverse=function(t,e){t.call(e,this);for(var i=0;i<this.children.length;i++)this.children[i].traverse(t,e)},e.prototype.updateDepthAndHeight=function(t){var e=0;this.depth=t;for(var i=0;i<this.children.length;i++){var o=this.children[i];o.updateDepthAndHeight(t+1),o.height>e&&(e=o.height)}this.height=e+1},e.prototype.getNodeById=function(t){if(this.id===t)return this;for(var e=0;e<this.children.length;e++){var i=this.children[e].getNodeById(t);if(i)return i}},i.prototype.traverse=function(t,e){this.root.traverse(t,e)},i.prototype.getSubTree=function(t){var e=this.getNodeById(t);if(e){var o=new i(e.id);return o.root=e,o}},i.prototype.getNodeById=function(t){return this.root.getNodeById(t)},i.fromOptionData=function(t,o){function r(t,i){var o=new e(t.name,t);i.add(o);var a=t.children;if(a)for(var n=0;n<a.length;n++)r(a[n],o)}var a=new i(t),n=a.root;n.data={name:t,children:o};for(var h=0;h<o.length;h++)r(o[h],n);return a.root.updateDepthAndHeight(0),a},i.fromGraph=function(t){function o(e){for(var i=t.getNodeById(e.id),r=0;r<i.outEdges.length;r++){var n=i.outEdges[r],h=a[n.node2.id];e.children.push(h),o(h)}}for(var r={},a={},n=0;n<t.nodes.length;n++){var h,l=t.nodes[n];0===l.inDegree()?(r[l.id]=new i(l.id),h=r[l.id].root):h=new e(l.id),h.data=l.data,a[l.id]=h}var s=[];for(var d in r)o(r[d].root),r[d].root.updateDepthAndHeight(0),s.push(r[d]);return s},i});